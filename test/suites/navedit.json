{ "suite": "Nav edit API",
  "handler": "nav",
  "it": "should {should}",
  "options": {
    "normalize": {
      "gametree": "gametree",
      "node": "node"
    }
  },
  "merge": {
    "context": "nav",
    "nav": [ 0 ],
    "board": true
  },
  "cases": [
    { "group": "#_addNode",
      "merge": {
        "method": "_addNode",
        "arguments": [ true ]
      },
      "options": {
        "normalize": {
          "return": "nodeinfo"
        }
      }
    },

    { "should": "add a node after the last node",
      "sgf": "(;;)",
      "updateBefore": [1],
      "return": {
        "path": [2],
        "node": {}
      },
      "path": [2],
      "node": {},
      "gametree": {
        "nodes": [ {}, {}, {} ]
      }
    },
    { "should": "create variations of the last node",
      "sgf": "(;;;C[])",
      "updateBefore": [1],
      "return": {
        "path": [1, 0],
        "node": {}
      },
      "path": [1, 0],
      "node": {},
      "gametree": {
        "nodes": [ {}, {} ],
        "variations": [ {
          "nodes": [ { "C": "" } ]
        }, {
          "nodes": [ {} ]
        } ]
      }
    },
    { "should": "add a variation after the node",
      "sgf": "(;;(;C[a])(;C[b]))",
      "updateBefore": [1],
      "return": {
        "path": [2, 0],
        "node": {}
      },
      "path": [2, 0],
      "node": {},
      "gametree": {
        "nodes": [ {}, {} ],
        "variations": [ {
          "nodes": [ { "C": "a" } ]
        }, {
          "nodes": [ { "C": "b" } ]
        }, {
          "nodes": [ {} ]
        } ]
      }
    },


    { "group": "#cut",
      "merge": {
        "method": "cut"
      },
      "options": {
        "normalize": {
          "return": "gametree"
        }
      }
    },

    { "should": "cut from a node",
      "sgf": "(;;;(;)(;))",
      "updateBefore": [1],
      "return": {
        "nodes": [ {}, {} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      },
      "path": [0],
      "gametree": {
        "nodes": [ {} ]
      }
    },
    { "should": "cut a variation",
      "sgf": "(;;(;)(;)(;))",
      "updateBefore": [0, 0],
      "return": {
        "nodes": [ {} ]
      },
      "path": [1],
      "gametree": {
        "nodes": [ {}, {} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      }
    },
    { "should": "cut a variation and merge remaining one",
      "sgf": "(;;(;)(;(;)(;)))",
      "updateBefore": [0, 0],
      "return": {
        "nodes": [ {} ]
      },
      "path": [1],
      "gametree": {
        "nodes": [ {}, {}, {} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      }
    },

    { "group": "#insert",
      "merge": {
        "method": "insert"
      },
      "options": {
        "normalize": {
          "arguments": [ "gametree" ]
        }
      }
    },

    { "should": "insert a gametree after a leaf node",
      "sgf": "(;C[a];C[b])",
      "arguments": [ {
        "nodes": [ {"C":"i"} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      } ],
      "updateBefore": [1],
      "return": [2],
      "gametree": {
        "nodes": [ {"C":"a"}, {"C":"b"}, {"C":"i"} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      }
    },
    { "should": "insert a gametree as a variation after a non-leaf node",
      "sgf": "(;C[a];C[b];C[c](;C[d])(;C[e]))",
      "arguments": [ {
        "nodes": [ {"C":"i"} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      } ],
      "updateBefore": [1],
      "return": [1, 0],
      "gametree": {
        "nodes": [ {"C":"a"}, {"C":"b"} ],
        "variations": [
          { "nodes": [ {"C":"c"} ],
            "variations": [
              { "nodes": [ {"C":"d"} ] },
              { "nodes": [ {"C":"e"} ] }
            ]
          },
          { "nodes": [ {"C":"i"} ],
            "variations": [
              { "nodes": [ {} ] },
              { "nodes": [ {} ] }
            ]
          }
        ]
      }
    },
    { "should": "insert a gametree as a new variation of existing ones",
      "sgf": "(;C[a];C[b](;C[c])(;C[d]))",
      "arguments": [ {
        "nodes": [ {"C":"i"} ],
        "variations": [
          { "nodes": [ {} ] },
          { "nodes": [ {} ] }
        ]
      } ],
      "updateBefore": [1],
      "return": [2, 0],
      "gametree": {
        "nodes": [ {"C":"a"}, {"C":"b"} ],
        "variations": [
          { "nodes": [ {"C":"c"} ] },
          { "nodes": [ {"C":"d"} ] },
          { "nodes": [ {"C":"i"} ],
            "variations": [
              { "nodes": [ {} ] },
              { "nodes": [ {} ] }
            ]
          }
        ]
      }
    }
  ]
}
